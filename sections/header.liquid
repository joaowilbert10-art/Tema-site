{% comment %}
  Header Section - Cabeçalho principal do site
  Inclui: Logo, navegação, carrinho, seletor de idioma
{% endcomment %}

<header class="header" role="banner">
  <div class="header__wrapper">
    <div class="container">
      <div class="header__content">
        <!-- Logo -->
        <div class="header__logo">
          <a href="{{ routes.root_url }}" class="header__logo-link" aria-label="{{ shop.name }}">
            {% if section.settings.logo != blank %}
              <img 
                src="{{ section.settings.logo | image_url: width: 200 }}"
                alt="{{ shop.name }}"
                class="header__logo-img"
                width="200"
                height="60"
                loading="eager"
              >
            {% else %}
              <span class="header__logo-text">{{ settings.brand_name | default: shop.name }}</span>
            {% endif %}
          </a>
        </div>

        <!-- Navegação Principal -->
        <nav class="header__nav" role="navigation" aria-label="{{ 'sections.header.navigation' | t }}">
          <ul class="header__nav-list">
            {% for link in linklists[section.settings.menu].links %}
              <li class="header__nav-item">
                <a 
                  href="{{ link.url }}" 
                  class="header__nav-link {% if link.active %}header__nav-link--active{% endif %}"
                  {% if link.current %}aria-current="page"{% endif %}
                >
                  {{ link.title }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </nav>

        <!-- Ações do Header -->
        <div class="header__actions">
          <!-- Seletor de Idioma -->
          {% if section.settings.show_language_selector and localization.available_languages.size > 1 %}
            <div class="header__language-selector">
              <button 
                class="header__language-btn"
                aria-expanded="false"
                aria-haspopup="true"
                aria-label="{{ 'localization.language_label' | t }}"
              >
                <span class="header__language-current">
                  {{ localization.language.iso_code | upcase }}
                </span>
                <svg class="header__language-icon" width="12" height="8" viewBox="0 0 12 8" fill="none">
                  <path d="M1 1.5L6 6.5L11 1.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
              
              <div class="header__language-dropdown" role="menu">
                {% for language in localization.available_languages %}
                  <a 
                    href="{{ language.root_url }}"
                    class="header__language-option {% if language.iso_code == localization.language.iso_code %}header__language-option--active{% endif %}"
                    role="menuitem"
                    hreflang="{{ language.iso_code }}"
                  >
                    {{ language.endonym_name }}
                  </a>
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <!-- Busca -->
          {% if section.settings.show_search %}
            <button 
              class="header__search-btn"
              aria-label="{{ 'general.search.search' | t }}"
              data-modal-trigger="search-modal"
            >
              <svg class="header__search-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M19 19L13 13M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          {% endif %}

          <!-- Conta do Usuário -->
          {% if shop.customer_accounts_enabled %}
            <a 
              href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
              class="header__account-btn"
              aria-label="{% if customer %}{{ 'customer.account.title' | t }}{% else %}{{ 'customer.log_in' | t }}{% endif %}"
            >
              <svg class="header__account-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M16 7C16 9.20914 14.2091 11 12 11C9.79086 11 8 9.20914 8 7C8 4.79086 9.79086 3 12 3C14.2091 3 16 4.79086 16 7Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M12 14C8.13401 14 5 17.134 5 21H19C19 17.134 15.866 14 12 14Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </a>
          {% endif %}

          <!-- Carrinho -->
          <a 
            href="{{ routes.cart_url }}"
            class="header__cart-btn"
            aria-label="{{ 'templates.cart.cart' | t }}"
          >
            <svg class="header__cart-icon" width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M3 3H5L5.4 5M7 13H17L21 5H5.4M7 13L5.4 5M7 13L4.7 15.3C4.3 15.7 4.6 16.5 5.1 16.5H17M17 13V17C17 17.6 16.6 18 16 18H8C7.4 18 7 17.6 7 17V13M9 19.5C9.8 19.5 10.5 20.2 10.5 21S9.8 22.5 9 22.5 7.5 21.8 7.5 21 8.2 19.5 9 19.5ZM20 19.5C20.8 19.5 21.5 20.2 21.5 21S20.8 22.5 20 22.5 18.5 21.8 18.5 21 19.2 19.5 20 19.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            {% if cart.item_count > 0 %}
              <span class="header__cart-count" aria-label="{{ 'sections.header.cart_count' | t: count: cart.item_count }}">
                {{ cart.item_count }}
              </span>
            {% endif %}
          </a>

          <!-- Menu Mobile -->
          <button 
            class="header__mobile-menu-btn"
            aria-label="{{ 'sections.header.menu' | t }}"
            aria-expanded="false"
            data-mobile-menu-trigger
          >
            <span class="header__mobile-menu-icon">
              <span></span>
              <span></span>
              <span></span>
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Menu Mobile -->
  <div class="header__mobile-menu" data-mobile-menu>
    <div class="header__mobile-menu-content">
      <nav class="header__mobile-nav" role="navigation">
        <ul class="header__mobile-nav-list">
          {% for link in linklists[section.settings.menu].links %}
            <li class="header__mobile-nav-item">
              <a 
                href="{{ link.url }}" 
                class="header__mobile-nav-link {% if link.active %}header__mobile-nav-link--active{% endif %}"
                {% if link.current %}aria-current="page"{% endif %}
              >
                {{ link.title }}
              </a>
            </li>
          {% endfor %}
        </ul>
      </nav>

      <div class="header__mobile-actions">
        {% if shop.customer_accounts_enabled %}
          <a 
            href="{% if customer %}{{ routes.account_url }}{% else %}{{ routes.account_login_url }}{% endif %}"
            class="btn btn-outline"
          >
            {% if customer %}{{ 'customer.account.title' | t }}{% else %}{{ 'customer.log_in' | t }}{% endif %}
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</header>

<!-- Modal de Busca -->
<div class="modal" data-modal="search-modal" role="dialog" aria-labelledby="search-modal-title" aria-hidden="true">
  <div class="modal__content">
    <div class="modal__header">
      <h2 id="search-modal-title" class="modal__title">{{ 'general.search.search' | t }}</h2>
      <button class="modal__close" data-modal-close aria-label="{{ 'accessibility.close' | t }}">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
    <div class="modal__body">
      <form action="{{ routes.search_url }}" method="get" class="search-form">
        <div class="search-form__field">
          <input 
            type="search" 
            name="q" 
            placeholder="{{ 'general.search.placeholder' | t }}"
            class="search-form__input"
            autocomplete="off"
            aria-label="{{ 'general.search.search' | t }}"
          >
          <button type="submit" class="search-form__submit" aria-label="{{ 'general.search.submit' | t }}">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M19 19L13 13M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<style>
  .header {
    background-color: white;
    border-bottom: 1px solid var(--color-base-050);
    position: sticky;
    top: 0;
    z-index: 100;
  }

  .header__wrapper {
    padding: var(--spacing-sm) 0;
  }

  .header__content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-lg);
  }

  .header__logo-link {
    display: flex;
    align-items: center;
    text-decoration: none;
  }

  .header__logo-img {
    height: 40px;
    width: auto;
  }

  .header__logo-text {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    font-weight: 700;
    color: var(--color-base-900);
  }

  .header__nav {
    display: none;
  }

  .header__nav-list {
    display: flex;
    align-items: center;
    gap: var(--spacing-xl);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__nav-link {
    font-weight: 500;
    color: var(--color-base-900);
    text-decoration: none;
    transition: color var(--transition-fast);
    position: relative;
  }

  .header__nav-link:hover,
  .header__nav-link--active {
    color: var(--color-cta-600);
  }

  .header__nav-link--active::after {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 0;
    right: 0;
    height: 2px;
    background-color: var(--color-cta-600);
  }

  .header__actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
  }

  .header__language-selector {
    position: relative;
  }

  .header__language-btn {
    display: flex;
    align-items: center;
    gap: var(--spacing-xs);
    background: none;
    border: none;
    padding: var(--spacing-xs);
    cursor: pointer;
    font-size: var(--text-sm);
    font-weight: 500;
    color: var(--color-base-900);
  }

  .header__language-icon {
    transition: transform var(--transition-fast);
  }

  .header__language-btn[aria-expanded="true"] .header__language-icon {
    transform: rotate(180deg);
  }

  .header__language-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: white;
    border: 1px solid var(--color-base-050);
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-lg);
    min-width: 120px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all var(--transition-fast);
    z-index: 10;
  }

  .header__language-btn[aria-expanded="true"] + .header__language-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .header__language-option {
    display: block;
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--color-base-900);
    text-decoration: none;
    transition: background-color var(--transition-fast);
  }

  .header__language-option:hover,
  .header__language-option--active {
    background-color: var(--color-base-050);
  }

  .header__search-btn,
  .header__account-btn,
  .header__cart-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    color: var(--color-base-900);
    cursor: pointer;
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
    position: relative;
  }

  .header__search-btn:hover,
  .header__account-btn:hover,
  .header__cart-btn:hover {
    background-color: var(--color-base-050);
    color: var(--color-cta-600);
  }

  .header__cart-count {
    position: absolute;
    top: -2px;
    right: -2px;
    background-color: var(--color-cta-600);
    color: white;
    font-size: var(--text-xs);
    font-weight: 600;
    min-width: 18px;
    height: 18px;
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header__mobile-menu-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    cursor: pointer;
  }

  .header__mobile-menu-icon {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .header__mobile-menu-icon span {
    width: 20px;
    height: 2px;
    background-color: var(--color-base-900);
    transition: all var(--transition-fast);
  }

  .header__mobile-menu-btn[aria-expanded="true"] .header__mobile-menu-icon span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
  }

  .header__mobile-menu-btn[aria-expanded="true"] .header__mobile-menu-icon span:nth-child(2) {
    opacity: 0;
  }

  .header__mobile-menu-btn[aria-expanded="true"] .header__mobile-menu-icon span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -6px);
  }

  .header__mobile-menu {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-normal);
  }

  .header__mobile-menu.active {
    opacity: 1;
    visibility: visible;
  }

  .header__mobile-menu-content {
    position: absolute;
    top: 0;
    right: 0;
    width: 300px;
    height: 100%;
    background-color: white;
    padding: var(--spacing-xl);
    transform: translateX(100%);
    transition: transform var(--transition-normal);
  }

  .header__mobile-menu.active .header__mobile-menu-content {
    transform: translateX(0);
  }

  .header__mobile-nav-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .header__mobile-nav-item {
    border-bottom: 1px solid var(--color-base-050);
  }

  .header__mobile-nav-link {
    display: block;
    padding: var(--spacing-md) 0;
    color: var(--color-base-900);
    text-decoration: none;
    font-weight: 500;
  }

  .header__mobile-nav-link:hover,
  .header__mobile-nav-link--active {
    color: var(--color-cta-600);
  }

  .header__mobile-actions {
    margin-top: var(--spacing-xl);
  }

  /* Modal de Busca */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all var(--transition-normal);
  }

  .modal.active {
    opacity: 1;
    visibility: visible;
  }

  .modal__content {
    background: white;
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
  }

  .modal__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--spacing-lg);
    border-bottom: 1px solid var(--color-base-050);
  }

  .modal__title {
    margin: 0;
    font-size: var(--text-xl);
    font-weight: 600;
  }

  .modal__close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--color-base-800);
    border-radius: var(--radius-md);
    transition: background-color var(--transition-fast);
  }

  .modal__close:hover {
    background-color: var(--color-base-050);
  }

  .modal__body {
    padding: var(--spacing-lg);
  }

  .search-form__field {
    position: relative;
  }

  .search-form__input {
    width: 100%;
    padding: var(--spacing-md);
    padding-right: 50px;
    border: 2px solid var(--color-base-050);
    border-radius: var(--radius-md);
    font-size: var(--text-base);
    transition: border-color var(--transition-fast);
  }

  .search-form__input:focus {
    outline: none;
    border-color: var(--color-cta-600);
  }

  .search-form__submit {
    position: absolute;
    right: 8px;
    top: 50%;
    transform: translateY(-50%);
    width: 36px;
    height: 36px;
    background: var(--color-cta-600);
    border: none;
    border-radius: var(--radius-md);
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color var(--transition-fast);
  }

  .search-form__submit:hover {
    background-color: var(--color-cta-700);
  }

  /* Responsividade */
  @media (min-width: 768px) {
    .header__nav {
      display: block;
    }

    .header__mobile-menu-btn {
      display: none;
    }

    .header__mobile-menu {
      display: none;
    }
  }

  @media (max-width: 767px) {
    .header__actions {
      gap: var(--spacing-sm);
    }

    .header__language-selector {
      display: none;
    }
  }
</style>

<script>
  // Menu mobile
  document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuBtn = document.querySelector('[data-mobile-menu-trigger]');
    const mobileMenu = document.querySelector('[data-mobile-menu]');
    
    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', function() {
        const isExpanded = mobileMenuBtn.getAttribute('aria-expanded') === 'true';
        mobileMenuBtn.setAttribute('aria-expanded', !isExpanded);
        mobileMenu.classList.toggle('active');
        document.body.style.overflow = isExpanded ? '' : 'hidden';
      });
    }

    // Seletor de idioma
    const languageBtn = document.querySelector('.header__language-btn');
    const languageDropdown = document.querySelector('.header__language-dropdown');
    
    if (languageBtn && languageDropdown) {
      languageBtn.addEventListener('click', function() {
        const isExpanded = languageBtn.getAttribute('aria-expanded') === 'true';
        languageBtn.setAttribute('aria-expanded', !isExpanded);
      });

      // Fechar dropdown ao clicar fora
      document.addEventListener('click', function(e) {
        if (!languageBtn.contains(e.target) && !languageDropdown.contains(e.target)) {
          languageBtn.setAttribute('aria-expanded', 'false');
        }
      });
    }
  });
</script>

{% schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo"
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menu de Navegação",
      "default": "main-menu"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Mostrar Busca",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_language_selector",
      "label": "Mostrar Seletor de Idioma",
      "default": true
    }
  ]
}
{% endschema %}
